jQuery(function(e){function t(e,t){"yes"===t.val()?(t.val("no"),e.removeClass("woocommerce-input-toggle--enabled").addClass("woocommerce-input-toggle--disabled")):(t.val("yes"),e.removeClass("woocommerce-input-toggle--disabled").addClass("woocommerce-input-toggle--enabled"))}function o(t){var o="yes"===wc_restrictions_admin_params.is_wc_version_gte_3_2?t.selectWoo("data"):t.select2("data"),n=[];return e.each(o,function(e,t){n.push({key:t.id,value:t.text})}),n}function n(e,t){var o=!1;return"object"==typeof p[e]&&"function"==typeof p[e][t]?o=p[e][t]:(o=wp.template("wc_csp_restriction_"+e+"_condition_"+t+"_content"),void 0===p[e]&&(p[e]={}),p[e][t]=o),o}function i(e){var t=!1;return"function"==typeof m[e]?t=m[e]:(t=wp.template("wc_csp_restriction_"+e+"_condition_row"),m[e]=t),t}function c(){var t=!1;a.find(".woocommerce_restriction").each(function(o,n){e(".position",n).val(o),e(".restriction_title_index",n).html(o+1),t=!0}),t?s.removeClass("disabled"):s.addClass("disabled")}e.fn.csp_select2=function(){e(document.body).trigger("wc-enhanced-select-init")},e.fn.csp_scripts=function(){e(this).csp_select2(),e(this).find(".woocommerce-help-tip, .help_tip, .tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})};var r=e("#restrictions_data"),s=r.find(".bulk_toggle_wrapper"),a=r.find(".wc-metaboxes"),d=a.find(".woocommerce_restrictions__boarding"),l=r.find(".toolbar"),_=a.find(".woocommerce_restriction").length;""===wc_restrictions_admin_params.post_id&&(r.closest("table.form-table").removeClass("form-table").addClass("restrictions-form-table"),e(".wccsp-delete-restriction-rule").on("click",function(){return window.confirm(wc_restrictions_admin_params.i18n_delete_rule_warning)}),e(".column-wc_actions a").on("mousedown",function(){e(this).triggerHandler("mouseleave")}),r.on("click",".wc-metabox > h3",function(){e(this).parent(".wc-metabox").toggleClass("closed").toggleClass("open"),e(this).next(".wc-metabox-content").stop().slideToggle(300)}),r.csp_select2(),e(".wc-metabox",r).each(function(){var t=e(this),o=t.find(".wc-metabox-content");t.hasClass("closed")&&o.hide()})),r.on("click",".wc-metabox > h3",function(e){e.target.id}).on("click","#active-toggle",function(){var o=e(this),n=o.closest(".wc-metabox").find(".wc-metabox-content > input.enabled"),i=o.closest(".woocommerce_restriction"),c=i.data("restriction_id"),r=i.data("index");if(i[0].className.indexOf("woocommerce_restriction--added")>-1)return t(o,n),!1;o.addClass("woocommerce-input-toggle--loading");var s={action:"woocommerce_toggle_restriction",value:n.val(),post_id:wc_restrictions_admin_params.post_id,hash:a.attr("data-hash"),index:r,restriction_id:c,security:wc_restrictions_admin_params.toggle_restriction_nonce};return e.ajax({url:wc_restrictions_admin_params.wc_ajax_url,data:s,method:"POST",dataType:"json",complete:function(){o.removeClass("woocommerce-input-toggle--loading")},success:function(e){e.errors.length>0?window.alert(e.errors.join("\n\n")):(t(o,n),a.attr("data-hash",e.hash))},error:function(){window.alert(wc_restrictions_admin_params.i18n_toggle_session_expired)}}),!1}).on("click",".remove_row",function(t){var o=e(this).closest(".wc-metabox");o.find("*").off(),o.remove(),c(),t.preventDefault()}),r.on("keyup","input.short_description",function(){e(this).closest(".woocommerce_restriction").find("h3 .restriction_title_inner").text(e(this).val())}).on("click",".expand_all",function(){return a.find(".wc-metabox").each(function(){var t=e(this);t.find(".wc-metabox-content").show(),t.addClass("open").removeClass("closed")}),!1}).on("click",".close_all",function(){return a.find(".wc-metabox").each(function(){var t=e(this);t.find(".wc-metabox-content").hide(),t.addClass("closed").removeClass("open")}),!1}).on("change","select.csp_shipping_countries",function(){var t=e(this),n=o(t),i=t.closest(".condition_content, .woocommerce_restriction_form").find("select.csp_shipping_states"),c=i.find(":selected"),r=[],s=wc_restrictions_admin_params.shipping_states_data,a=[];c.each(function(){r.push(e(this).val())}),e.each(n,function(t,o){var n=[],i=o.key,c=o.value,d=s[i]||!1;if(!d)return!0;e.each(d,function(t,o){var s=i+":"+t;n.push({id:s,text:c+" â€” "+o,selected:-1!==e.inArray(s,r)})}),a.push({text:c,children:n})}),i.children().remove(),"yes"===wc_restrictions_admin_params.is_wc_version_gte_3_2?i.selectWoo({data:a}):"yes"===wc_restrictions_admin_params.is_wc_version_gte_3_0?i.select2({data:a}):(e.each(a,function(t,o){var n=e("<optgroup/>").prop("label",o.text);e.each(o.children,function(t,o){var i=e("<option/>").text(o.text).val(o.id);o.selected&&i.prop("selected",!0),n.append(i)}),i.append(n)}),i.trigger("change"))}).on("click",".wccsp_select_all",function(){return e(this).closest(".select-field").find("> select option").prop("selected","selected"),e(this).closest(".select-field").find("> select").trigger("change"),!1}).on("click",".wccsp_select_none",function(){return e(this).closest(".select-field").find("> select option").removeAttr("selected"),e(this).closest(".select-field").find("> select").trigger("change"),!1}).on("click","button.add_restriction",function(){var t=e("select.restriction_type",r).val(),o=a.find(".woocommerce_restriction_"+t),n=a.find(".woocommerce_restriction");if(""===t)return!1;var i={message:null,overlayCSS:{background:"#fff",opacity:.6}};r.block(i);var c={action:"woocommerce_add_checkout_restriction",post_id:wc_restrictions_admin_params.post_id,index:_,restriction_id:t,applied_count:o.length,count:n.length,security:wc_restrictions_admin_params.add_restriction_nonce};return _++,setTimeout(function(){e.post(wc_restrictions_admin_params.wc_ajax_url,c,function(e){if(e.errors.length>0)window.alert(e.errors.join("\n\n"));else{r.trigger("woocommerce_before_restriction_add",e),a.append(e.markup);var t=a.find(".woocommerce_restriction").last();t.csp_scripts(),t.data("conditions_count",0),s.removeClass("disabled")}r.unblock(),r.trigger("woocommerce_restriction_added",e)},"json")},250),!1}).on("woocommerce_before_restriction_add",function(){d.length&&(d.hide(),l.removeClass("restriction_data--empty"))});var m={},p={};a.find(".woocommerce_restriction").each(function(){var t=e(this).find(".restriction_conditions .condition_row").length;e(this).data("conditions_count",t)}),r.on("mousedown",".condition_remove .trash",function(){e(this).triggerHandler("mouseleave")}).on("click",".condition_remove .trash",function(t){return t.preventDefault(),e(this).closest(".condition_row").remove(),!0}).on("change",".condition_add select.condition_type",function(){var t=e(this),o=t.val();if("add_condition"===o)return!1;var c=t.closest(".woocommerce_restriction"),r=c.data("restriction_id"),s=parseInt(c.data("index")),a=parseInt(c.data("conditions_count")),d=i(r),l=n(r,o);if(!d||!l)return!1;var _=d({condition_index:a,condition_content:l({restriction_index:s,condition_index:a})});c.data("conditions_count",a+1),c.find(".restriction_conditions_list").append(_);var m=c.find(".restriction_conditions_list .condition_row").last();return m.find('.condition_type option[value="'+o+'"]').prop("selected","selected"),m.csp_scripts(),t.find('option[value="add_condition"]').prop("selected","selected"),!1}).on("change",".restriction_conditions_list select.condition_type",function(){var t=e(this),o=t.val(),i=t.closest(".woocommerce_restriction"),c=i.data("restriction_id"),r=parseInt(i.data("index")),s=t.closest(".condition_row"),a=parseInt(s.data("condition_index")),d=n(c,o);if(!d)return!1;var l=d({restriction_index:r,condition_index:a});s.find(".condition_content").html(l).addClass("added");var _=s.find(".added");return _.csp_scripts(),_.removeClass("added"),!1}),function(){var t=a.find(".woocommerce_restriction").get();t.sort(function(t,o){var n=parseInt(e(t).attr("data-index")),i=parseInt(e(o).attr("data-index"));return n<i?-1:n>i?1:0}),e(t).each(function(e,t){a.append(t)}),c(),a.sortable({items:".woocommerce_restriction",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style"),c()}})}()});