{"version":3,"sources":["ecommerce2/assets/js/admin.js"],"names":["r","e","n","t","o","i","f","c","u","a","Error","code","p","exports","call","length","1","require","module","element","count","wrapper","bar","document","createElement","step_size","progress","done","style","height","width","border","lineHeight","boxSizing","backgroundColor","textAlign","fontWeight","color","fontSize","appendChild","tick","ticks","undefined","innerText","parseInt","2","url","options","request","XMLHttpRequest","onreadystatechange","this","readyState","status","onSuccess","responseText","onError","open","method","toUpperCase","setRequestHeader","send","data","3","progress_bar","ProgressBar","mc4wp_ecommerce","untracked_order_count","form","getElementById","progressBarMount","updateProgress","new_count","fetchProgress","window","setTimeout","location","reload","ajaxurl","addEventListener","preventDefault","querySelector","setAttribute","work","limit","elements","value","offset","previousCount","textElement","innerHTML","parentNode","response","./_progress-bar.js","./_request.js"],"mappings":"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","file":"admin.min.js","sourcesContent":["(function () { var require = undefined; var define = undefined; (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\nfunction ProgressBar(element, count) {\n\tvar wrapper = element,\n\t    bar = document.createElement('div'),\n\t    step_size = 100 / count,\n\t    progress = 0;\n\n\twrapper.style.height = \"40px\";\n\twrapper.style.width = \"100%\";\n\twrapper.style.border = \"1px solid #ccc\";\n\twrapper.style.lineHeight = \"40px\";\n\n\tbar.style.boxSizing = 'border-box';\n\tbar.style.backgroundColor = '#cc4444';\n\tbar.style.textAlign = 'center';\n\tbar.style.fontWeight = 'bold';\n\tbar.style.height = \"100%\";\n\tbar.style.color = 'white';\n\tbar.style.fontSize = '16px';\n\tbar.style.width = progress + \"%\";\n\twrapper.appendChild(bar);\n\n\tfunction tick(ticks) {\n\t\tif (done()) {\n\t\t\treturn;\n\t\t}\n\n\t\tticks = ticks === undefined ? 1 : ticks;\n\t\tprogress += step_size * ticks;\n\t\tbar.style.width = progress + \"%\";\n\n\t\tbar.innerText = parseInt(progress) + \"%\";\n\n\t\tif (done()) {\n\t\t\tbar.innerText = 'Done!';\n\t\t}\n\t}\n\n\tfunction done() {\n\t\treturn progress >= 100;\n\t}\n\n\treturn {\n\t\t'tick': tick,\n\t\t'done': done\n\t};\n}\n\nmodule.exports = ProgressBar;\n\n},{}],2:[function(require,module,exports){\n'use strict';\n\nfunction request(url, options) {\n\n\tvar request = new XMLHttpRequest();\n\trequest.onreadystatechange = function () {\n\t\tif (this.readyState === 4) {\n\t\t\tif (this.status >= 200 && this.status < 400) {\n\t\t\t\toptions.onSuccess && options.onSuccess(this.responseText);\n\t\t\t} else {\n\t\t\t\toptions.onError && options.onError(this.status, this.responseText);\n\t\t\t}\n\t\t}\n\t};\n\trequest.open(options.method || 'GET', url, true);\n\n\tif (options.method && options.method.toUpperCase() === 'POST') {\n\t\trequest.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded; charset=UTF-8');\n\t}\n\n\trequest.send(options.data || {});\n\treturn request;\n}\n\nmodule.exports = request;\n\n},{}],3:[function(require,module,exports){\n'use strict';\n\nvar ProgressBar = require('./_progress-bar.js');\nvar request = require('./_request.js');\nvar count = mc4wp_ecommerce.untracked_order_count;\nvar form = document.getElementById('add-untracked-orders-form');\nvar progressBarMount = document.getElementById('add-untracked-orders-progress');\nvar progress_bar, progress_poll, worker;\n\n// hook into form submit\nif (form) {\n\tform.addEventListener('submit', start);\n}\n\nfunction start(e) {\n\n\t// prevent default form submit\n\te.preventDefault();\n\n\tvar button = form.querySelector('input[type=\"submit\"]');\n\tbutton.setAttribute('disabled', true);\n\n\t// init progress bar\n\tprogress_bar = new ProgressBar(progressBarMount, count);\n\tprogress_poll = window.setTimeout(fetchProgress, 500);\n\twork();\n}\n\nfunction work() {\n\tvar limit = parseInt(form.elements[\"limit\"].value);\n\tvar offset = parseInt(form.elements[\"offset\"].value);\n\tvar url = ajaxurl + \"?action=mc4wp_ecommerce_add_untracked_orders&offset=\" + offset + \"&limit=\" + limit;\n\tvar previousCount = count;\n\n\tworker = request(url, {\n\t\tonSuccess: function onSuccess(data) {\n\t\t\tupdateProgress(data);\n\n\t\t\tif (previousCount <= data) {\n\t\t\t\t// We're not making progress..\n\t\t\t\tvar textElement = document.createElement('p');\n\t\t\t\ttextElement.style.color = 'red';\n\t\t\t\ttextElement.innerHTML = \"We're stuck. Please <a href=\\\"admin.php?page=mailchimp-for-wp-other\\\">check the debug log</a> for errors.\";\n\t\t\t\tprogressBarMount.parentNode.appendChild(textElement);\n\t\t\t} else if (data > 0) {\n\t\t\t\t// Keep going if there's more\n\t\t\t\twork();\n\t\t\t}\n\t\t},\n\n\t\tonError: function onError(code, response) {\n\t\t\t// if we got a 504 Gateway Timeout, try again.\n\t\t\tif (code == 504) {\n\t\t\t\twork();\n\t\t\t}\n\t\t}\n\t});\n}\n\nfunction updateProgress(new_count) {\n\tprogress_bar.tick(count - new_count);\n\tcount = new_count;\n}\n\nfunction fetchProgress() {\n\tif (progress_bar.done()) {\n\n\t\t// refresh page\n\t\twindow.setTimeout(function () {\n\t\t\twindow.location.reload();\n\t\t}, 2500);\n\n\t\treturn;\n\t}\n\n\tvar url = ajaxurl + \"?action=mc4wp_ecommerce_get_untracked_orders_count\";\n\trequest(url, {\n\t\tonSuccess: function onSuccess(data) {\n\t\t\tupdateProgress(data);\n\t\t\twindow.setTimeout(fetchProgress, 2000);\n\t\t}\n\t});\n}\n\n},{\"./_progress-bar.js\":1,\"./_request.js\":2}]},{},[3]);\n })();"]}