"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function r(e,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,a,t){return a&&r(e.prototype,a),t&&r(e,t),e}}();function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}(function(){var t=[].indexOf;jQuery(document).ready(function(r){return window.WC_Authorize_Net_AIM_Accept_JS_Handler=function(){function e(){var t=this;_classCallCheck(this,e),this.params=window.wc_authorize_net_aim_params,void 0!==this.params&&this.params.accept_js_enabled&&(r(document.body).on("sv_wc_payment_form_valid_payment_data",function(e,a){return t.init(e,a)}),r(document.body).on("checkout_error",function(){return r("input[name=wc-authorize-net-aim-payment-nonce]").val("")}))}return _createClass(e,[{key:"init",value:function(e,a){if(this.payment_form=a.payment_form,this.errors=[],"authorize_net_aim"===this.payment_form.id&&a.passed_validation)return!this.payment_form.payment_fields.find("input[name=wc-authorize-net-aim-payment-nonce]").length||(!!this.has_nonce()||(this.dispatch_card(),!1))}},{key:"dispatch_card",value:function(){var e,a=this;return this.payment_form.block_ui(),e=this.get_request_data(),this.log_request(e),Accept.dispatchData(e,function(e){return a.handle_response(e)})}},{key:"get_request_data",value:function(){var e,a,t;return t=r.payment.cardExpiryVal(r("input[name=wc-authorize-net-aim-expiry]").val()),a={authData:{clientKey:this.params.client_key,apiLoginID:this.params.login_id},cardData:{cardNumber:r("input[id=wc-authorize-net-aim-account-number]").val().replace(/-|\s/g,""),month:t.month.toString(),year:t.year.toString()}},null!=(e=this.payment_form.payment_fields.find("input[id=wc-authorize-net-aim-csc]").val())&&this.payment_form.csc_required&&(a.cardData.cardCode=e),a}},{key:"handle_response",value:function(e){var a,t,r,n;if(this.log_response(e),"Error"!==e.messages.resultCode)return this.set_nonce(e.opaqueData.dataValue,e.opaqueData.dataDescriptor),this.payment_form.form.submit();for(a=0,t=(n=e.messages.message).length;a<t;a++)r=n[a],this.handle_error(r.code,r.text);return this.payment_form.render_errors(this.errors),this.payment_form.unblock_ui()}},{key:"set_nonce",value:function(e,a){var t;return r("input[name=wc-authorize-net-aim-payment-nonce]").val(e),r("input[name=wc-authorize-net-aim-payment-descriptor]").val(a),t=r("input[id=wc-authorize-net-aim-account-number]").val(),r("input[name=wc-authorize-net-aim-card-type]").val(r.payment.cardType(t)),r("input[name=wc-authorize-net-aim-last-four]").val(t.slice(-4))}},{key:"handle_error",value:function(e,a){switch(console.log("Authorize.Net AIM Error: "+a+" ("+e+")"),e){case"E_WC_05":a=this.payment_form.params.card_number_invalid;break;case"E_WC_06":case"E_WC_07":case"E_WC_08":case"E00073":a=this.payment_form.params.card_exp_date_invalid;break;case"E_WC_15":a=this.payment_form.params.cvv_length_invalid;break;default:a=this.params.general_error}if(t.call(this.errors,a)<0)return this.errors.push(a)}},{key:"has_nonce",value:function(){return r("input[name=wc-authorize-net-aim-payment-nonce]").val()}},{key:"log_request",value:function(e){var a;return(a=this.clone_log_data(e)).cardData&&(a.cardData.cardNumber&&(a.cardData.cardNumber=a.cardData.cardNumber.replace(/\d(?=\d{4})/g,"*")),a.cardData.cardCode&&(a.cardData.cardCode=a.cardData.cardCode.replace(/[0-9]/g,"*"))),this.log_data(a,"request")}},{key:"log_response",value:function(e){return this.log_data(e,"response")}},{key:"clone_log_data",value:function(e){var a,t;if(null==e||"object"!==(void 0===e?"undefined":_typeof(e)))return e;for(a in t={},e)t[a]=this.clone_log_data(e[a]);return t}},{key:"log_data",value:function(e,a){var t;if(this.params.ajax_log)return t={action:"wc_"+this.payment_form.id+"_log_js_data",security:this.params.ajax_log_nonce,type:a,data:e},r.ajax({url:this.params.ajax_url,data:t})}}]),e}(),window.wc_authorize_net_aim_accept_js_handler=new WC_Authorize_Net_AIM_Accept_JS_Handler})}).call(void 0);